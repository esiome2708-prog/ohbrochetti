<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oh Brochetti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-bubble {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
        }
        .chat-container {
            position: fixed;
            bottom: 7rem;
            right: 2rem;
            width: 90vw;
            max-width: 400px;
            height: 60vh;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 50;
        }
        .chat-header {
            background: #f7e9c9;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-body {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .chat-message {
            max-width: 80%;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
        }
        .user-message {
            align-self: flex-end;
            background: #d1fae5;
        }
        .bot-message {
            align-self: flex-start;
            background: #e2e8f0;
        }
        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
        }
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
        }
        .cart-bubble {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
            padding: 1rem;
            background: #f97316;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        .cart-bubble:hover {
            background-color: #ea580c;
        }
        .cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #ef4444;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            transform: translate(50%, -50%);
        }
        .menu-item-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <main class="container mx-auto p-4 md:p-8 lg:p-12">
        <!-- Section d'en-tête -->
        <header class="text-center my-8 md:my-12">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-amber-600 drop-shadow-md">Oh Brochetti</h1>
            <p class="mt-4 text-xl md:text-2xl text-slate-600 font-light">
                Explorez le meilleur de la cuisine Malgache, Indienne et Créole.
            </p>
            <div class="mt-8 flex justify-center">
                
            </div>
        </header>

        <!-- Section des brochettes -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Brochettes</h2>
            <p class="text-center text-slate-500 mb-8">
                Cliquez sur un plat pour voir les détails.
            </p>
             <div class="flex justify-center my-8">
                
            </div>
            <div id="brochettes-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Les plats seront insérés ici par JavaScript -->
            </div>
        </section>

        <!-- Section des plats traditionnels -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Plats Traditionnels</h2>
            <p class="text-center text-slate-500 mb-8">
                Cliquez sur un plat pour voir les détails.
            </p>
            <div class="flex justify-center my-8">
                
            </div>
            <div id="traditional-dishes-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Les plats seront insérés ici par JavaScript -->
            </div>
        </section>

        <!-- Section des soupes -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Soupes</h2>
            <p class="text-center text-slate-500 mb-8">
                Cliquez sur un plat pour voir les détails.
            </p>
            <div class="flex justify-center my-8">
                
            </div>
            <div id="soupes-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Les plats seront insérés ici par JavaScript -->
            </div>
        </section>

        <!-- Section des rôtis au four -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Rôtis au Four</h2>
            <p class="text-center text-slate-500 mb-8">
                Cliquez sur un plat pour voir les détails.
            </p>
            <div class="flex justify-center my-8">
                
            </div>
            <div id="roti-au-four-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Les plats seront insérés ici par JavaScript -->
            </div>
        </section>

        <!-- Section des accompagnements -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Accompagnements Maison</h2>
            <p class="text-center text-slate-500 mb-8">
                Cliquez sur un plat pour voir les détails.
            </p>
            <div class="flex justify-center my-8">
                
            </div>
            <div id="side-dishes-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Les accompagnements seront insérés ici par JavaScript -->
            </div>
        </section>

        <!-- Section des cakes -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Cakes Maison</h2>
            <p class="text-center text-slate-500 mb-8">
                Cliquez sur un plat pour voir les détails.
            </p>
            <div class="flex justify-center my-8">
                
            </div>
            <div id="cakes-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Les plats seront insérés ici par JavaScript -->
            </div>
        </section>

        <!-- Section de livraison -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Livraison</h2>
            <p class="text-center text-lg text-slate-600">
                Nous livrons sur un point de rendez-vous.
            </p>
            <div id="delivery-info" class="mt-6 max-w-lg mx-auto">
                <ul class="space-y-4">
                    <!-- Les zones de livraison seront insérées ici par JavaScript -->
                </ul>
            </div>
        </section>

        <!-- Section des points de rendez-vous -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Points de Rendez-vous</h2>
            <p class="text-center text-lg text-slate-600 mb-6">
                Choisissez votre point de rendez-vous parmi la liste ci-dessous.
            </p>
            <div id="rendezvous-info" class="mt-6 max-w-lg mx-auto">
                <ul class="space-y-4">
                    <!-- Les points de rendez-vous seront insérés ici par JavaScript -->
                </ul>
            </div>
        </section>

        <!-- Section du formulaire de commande -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-8">Vos informations</h2>
            <p class="text-center text-lg text-slate-600 mb-6">
                Veuillez remplir vos informations de contact pour la livraison.
            </p>
            <form id="order-form" class="max-w-xl mx-auto space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-slate-700">Votre Nom Complet</label>
                    <input type="text" id="name" name="name" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2 border" required>
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-slate-700">Votre Numéro de Téléphone</label>
                    <input type="tel" id="phone" name="phone" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2 border" required>
                </div>
                
                <div class="mt-4">
                    <label for="delivery-zone" class="block text-sm font-medium text-slate-700">Zone de Livraison</label>
                    <select id="delivery-zone" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2 border">
                        <!-- Options générées par JS -->
                    </select>
                </div>
                
                <div class="mt-4">
                    <label for="rendezvous-point" class="block text-sm font-medium text-slate-700">Point de Rendez-vous</label>
                    <select id="rendezvous-point" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2 border">
                        <!-- Options générées par JS -->
                    </select>
                </div>
                
                <div>
                    <label for="delivery-date" class="block text-sm font-medium text-slate-700">Date de livraison souhaitée</label>
                    <input type="date" id="delivery-date" name="delivery-date" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2 border" required>
                    <p class="mt-2 text-xs text-amber-600">
                        * Les commandes doivent être passées 48h à l'avance pour assurer au moins 24h de marinade pour les viandes (du lundi au vendredi). Pour une livraison le samedi, contactez-nous au préalable pour vérifier la disponibilité.
                    </p>
                </div>

                <div>
                    <label for="custom-note" class="block text-sm font-medium text-slate-700">Note de personnalisation (facultatif)</label>
                    <textarea id="custom-note" name="custom-note" rows="3" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2 border" placeholder="Ex: 'sans oignons', 'sans épices', etc."></textarea>
                </div>
                
                <div class="flex justify-center">
                    <button type="button" onclick="showCartModal()" class="w-full md:w-auto px-6 py-3 bg-amber-600 text-white rounded-full font-bold shadow-lg hover:bg-amber-700 transition-colors">
                        Voir le panier et commander
                    </button>
                </div>
                <p class="text-center text-sm text-slate-500 mt-4">
                    Votre commande sera préparée pour être envoyée via WhatsApp.
                </p>
            </form>
        </section>

        <!-- Section de contact -->
        <section class="bg-white rounded-3xl shadow-xl p-6 md:p-10 my-10 border border-slate-200 text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-slate-900 mb-4">Contact</h2>
            <p class="text-lg text-slate-600 mb-2">Pour toute question ou commande, contactez-nous au :</p>
            <a href="tel:0693805535" class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-amber-600 hover:underline">0693 80 55 35</a>
        </section>

        <!-- Pied de page -->
        <footer class="text-center mt-12 mb-4 text-slate-500 text-sm">
            <p>&copy; 2024 Oh Brochetti. Tous droits réservés.</p>
        </footer>
    </main>

    <!-- Bulle de chat AI -->
    <div id="chat-bubble" class="chat-bubble cursor-pointer p-4 bg-amber-600 rounded-full shadow-lg hover:bg-amber-700 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </div>

    <!-- Bulle du panier d'achat -->
    <div id="cart-bubble" class="cart-bubble" onclick="showCartModal()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <span id="cart-count" class="cart-count">0</span>
    </div>

    <div id="chat-container" class="chat-container hidden">
        <div class="chat-header">
            <h3 class="text-lg font-bold text-slate-900">Assistant Menu ✨</h3>
            <button id="close-chat" class="text-slate-500 hover:text-slate-800" onclick="chatContainer.classList.add('hidden');">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="chat-body" class="chat-body">
            <div class="bot-message chat-message">Bonjour ! Comment puis-je vous aider à choisir votre plat ? Posez-moi une question sur le menu !</div>
        </div>
        <div class="chat-input-container">
            <input id="chat-input" type="text" class="flex-grow rounded-full p-2 border border-slate-300 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="Demandez une recommandation..." />
            <button id="send-chat" class="p-2 bg-amber-600 text-white rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <!-- Modal pour ajouter un plat au panier avec quantité -->
    <div id="add-to-cart-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold mb-4">Ajouter au panier</h3>
            <div id="modal-body" class="mb-4">
                <img id="modal-image" class="mx-auto rounded-lg mb-4" src="" alt="plat">
                <p id="modal-description" class="text-slate-600 mb-4"></p>
                <div class="flex items-center justify-center gap-4">
                    <button id="modal-minus" class="p-2 bg-slate-200 rounded-full text-slate-600 hover:bg-slate-300 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4"></path></svg>
                    </button>
                    <span id="modal-quantity" class="text-2xl font-bold">1</span>
                    <button id="modal-plus" class="p-2 bg-amber-600 rounded-full text-white hover:bg-amber-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg>
                    </button>
                </div>
            </div>
            <button id="modal-add-button" class="w-full px-6 py-3 bg-amber-600 text-white rounded-full font-bold shadow-lg hover:bg-amber-700 transition-colors mt-4">
                Ajouter <span id="modal-add-price"></span>
            </button>
        </div>
    </div>
    <script>
        //
        // --- INSTRUCTIONS POUR LA MISE À JOUR DU MENU ---
        //
        // 1. Pour modifier votre menu, il vous suffit de modifier les objets ci-dessous.
        // 2. Les allergènes ont été identifiés automatiquement par une IA.
        // 3. Ajoutez ou supprimez des éléments dans les tableaux des différentes catégories.
        // 4. Modifiez 'deliveryData' pour mettre à jour les prix de livraison par zone.
        // 5. Les changements seront automatiquement affichés sur la page.
        // 6. NOTE : Pour les calculs, les prix ont été convertis en nombres.
        //

        const menuData = {
            brochettes: [
                {
                    id: "brochette-boeuf",
                    name: "Brochette de boeuf",
                    cuisine: "Malgache",
                    price: 10.00,
                    description: "Une portion de 250 g, environ 12 tiges. Les brochettes sont préparées, marinées et piquées, prêtes à être cuites chez vous au barbecue ou à la plancha (viande Halal).",
                    ingredients: ["Viande de boeuf", "Épices malgaches"],
                    allergens: [],
                    image: "https://placehold.co/400x300/e9d5ff/6b21a8?text=Brochette+de+boeuf"
                },
                {
                    id: "brochette-poulet",
                    name: "Brochette de poulet",
                    cuisine: "Malgache",
                    price: 8.50,
                    description: "Une portion de 250 g, environ 10 tiges. Les brochettes sont préparées, marinées et piquées, prêtes à être cuites chez vous au barbecue ou à la plancha (viande Halal).",
                    ingredients: ["Poulet", "Épices malgaches"],
                    allergens: [],
                    image: "https://placehold.co/400x300/dbeafe/1e40af?text=Brochette+de+poulet"
                },
                {
                    id: "brochette-agneau",
                    name: "Brochette d'agneau",
                    cuisine: "Malgache",
                    price: 12.00,
                    description: "Brochette d'agneau tendre et juteux.",
                    ingredients: ["Agneau", "Épices malgaches"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fecaca/991b1b?text=Brochette+d'agneau"
                },
                {
                    id: "brochette-magret",
                    name: "Brochette de Magret",
                    cuisine: "Malgache",
                    price: 11.00,
                    description: "Délicieuse brochette de Magret de canard.",
                    ingredients: ["Magret de canard", "Épices malgaches"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fed7aa/ea580c?text=Brochette+de+Magret"
                },
            ],
            traditionalDishes: [
                 {
                    id: "sabeda",
                    name: "Sabeda (Sousoua)",
                    cuisine: "Malgache",
                    price: 14.50,
                    description: "Soupe traditionnelle à la malgache.",
                    ingredients: ["Viande au choix", "Légumes", "Épices"],
                    allergens: [],
                    image: "https://placehold.co/400x300/d1fae5/065f46?text=Sabeda"
                },
                {
                    id: "vary-anana",
                    name: "Vary @anana (brèdes)",
                    cuisine: "Malgache",
                    price: 9.00,
                    description: "Un plat à base de brèdes. Nature ou avec Kimo (viande).",
                    ingredients: ["Riz", "Brèdes", "Ail", "Gingembre"],
                    allergens: [],
                    image: "https://placehold.co/400x300/e0f2f1/0f766e?text=Vary+anana"
                },
                {
                    id: "romazave-boeuf",
                    name: "Romazave boeuf",
                    cuisine: "Malgache",
                    price: 15.00,
                    description: "Plat national malgache. Un bouillon parfumé aux brèdes et au bœuf, servi avec du riz (viande Halal).",
                    ingredients: ["Boeuf", "Brèdes", "Gingembre", "Ail", "Riz"],
                    allergens: [],
                    image: "https://placehold.co/400x300/f5d0fe/7e22ce?text=Romazave+boeuf"
                },
                {
                    id: "romazave-poulet",
                    name: "Romazave Poulet",
                    cuisine: "Malgache",
                    price: 13.00,
                    description: "Un bouillon de brèdes et poulet, typique de la cuisine malgache, servi avec du riz (viande Halal).",
                    ingredients: ["Poulet", "Brèdes", "Gingembre", "Ail", "Riz"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fef08a/b45309?text=Romazave+poulet"
                },
                {
                    id: "hena-ritra",
                    name: "Hena Ritra",
                    cuisine: "Malgache",
                    price: 16.00,
                    description: "Un mijoté de bœuf braisé malgache, cuit lentement avec du gingembre, de l'ail et des épices. La viande est très tendre et fondante.",
                    ingredients: ["Boeuf", "Oignon", "Ail", "Gingembre", "Épices"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fce7f3/9d174d?text=Hena+Ritra"
                },
            ],
            soups: [
                {
                    id: "soupe-legumes",
                    name: "Soupe de légumes",
                    cuisine: "Malgache",
                    price: 8.00,
                    description: "Une soupe de légumes fraîche et savoureuse.",
                    ingredients: ["Légumes", "Bouillon"],
                    allergens: [],
                    image: "https://placehold.co/400x300/ffedd5/9a3412?text=Soupe+de+légumes"
                },
                {
                    id: "soupe-chinoise",
                    name: "Soupe chinoise",
                    cuisine: "Malgache",
                    price: 8.00,
                    description: "Soupe chinoise aux vermicelles, légumes et poulet.",
                    ingredients: ["Poulet", "Vermicelles", "Légumes"],
                    allergens: [],
                    image: "https://placehold.co/400x300/f0f9ff/0c4a6e?text=Soupe+chinoise"
                },
                {
                    id: "soupe-paya",
                    name: "Soupe Paya (pieds de boeuf)",
                    cuisine: "Malgache",
                    price: 8.00,
                    description: "Soupe traditionnelle malgache à base de pieds de boeuf.",
                    ingredients: ["Pieds de boeuf", "Légumes", "Épices"],
                    allergens: [],
                    image: "https://placehold.co/400x300/dcfce7/166534?text=Soupe+Paya"
                },
                {
                    id: "soupe-orientale",
                    name: "Soupe Orientale",
                    cuisine: "Malgache",
                    price: 8.00,
                    description: "Soupe à la semoule et aux légumes, parfumée aux épices orientales.",
                    ingredients: ["Semoule", "Légumes", "Épices"],
                    allergens: ["Céréales contenant du gluten"],
                    image: "https://placehold.co/400x300/eff6ff/1e40af?text=Soupe+Orientale"
                }
            ],
            rotiAuFour: [
                {
                    id: "poulet-entier",
                    name: "Poulet entier",
                    cuisine: "Malgache",
                    price: 25.00,
                    description: "Nature ou farci aux oignons, pommes de terre et champignons (viande Halal).",
                    ingredients: ["Poulet", "Oignons", "Pommes de terre", "Champignons"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fff7ed/9a3412?text=Poulet+entier"
                },
                {
                    id: "gigot-agneau-roti",
                    name: "Gigot d'agneau rôti",
                    cuisine: "Malgache",
                    price: 35.00,
                    description: "Un gigot d'agneau rôti au four (viande Halal).",
                    ingredients: ["Agneau"],
                    allergens: [],
                    image: "https://placehold.co/400x300/f0f9ff/0c4a6e?text=Gigot+d'agneau"
                },
            ],
            sideDishes: [
                {
                    id: "rougail",
                    name: "Rougail",
                    cuisine: "Créole",
                    price: 4.50,
                    description: "Un rougail de la Réunion, un condiment qui change selon la saison (ex: tomate, concombre, papaye, mangue).",
                    ingredients: ["Selon la saison", "tomates", "concombre", "papaye", "mangue", "piment"],
                    allergens: [],
                    image: "https://placehold.co/400x300/dcfce7/166534?text=Rougail"
                },
                {
                    id: "piment",
                    name: "Piment",
                    cuisine: "Créole",
                    price: 1.00,
                    description: "Pâte de piment frais pour relever vos plats. Attention, c'est fort !",
                    ingredients: ["Piments frais", "Huile"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fee2e2/991b1b?text=Piment"
                },
                {
                    id: "manioc",
                    name: "Manioc",
                    price: 3.50,
                    description: "Manioc bouilli ou frit, au choix.",
                    ingredients: ["Manioc"],
                    allergens: [],
                    image: "https://placehold.co/400x300/e9d5ff/6b21a8?text=Manioc"
                },
                {
                    id: "gratin-legume",
                    name: "Gratin de légume",
                    price: 4.00,
                    description: "Un gratin de légumes du jour.",
                    ingredients: ["Légumes", "Lait", "Fromage"],
                    allergens: ["Lait"],
                    image: "https://placehold.co/400x300/f3e8ff/5b21b6?text=Gratin+de+legume"
                },
                {
                    id: "legumes-sautes",
                    name: "Assortiment de légumes sautés",
                    price: 4.00,
                    description: "Un mélange de légumes frais légèrement sautés.",
                    ingredients: ["Légumes variés"],
                    allergens: [],
                    image: "https://placehold.co/400x300/ccfbf1/0f766e?text=Legumes+sautes"
                },
                {
                    id: "taboule",
                    name: "Taboulé",
                    price: 3.00,
                    description: "Taboulé frais aux herbes et à la tomate.",
                    ingredients: ["Semoule", "Tomate", "Concombre", "Menthe", "Persil", "Citron"],
                    allergens: ["Céréales contenant du gluten"],
                    image: "https://placehold.co/400x300/dcfce7/166534?text=Taboule"
                },
                {
                    id: "salade-composee",
                    name: "Salade composée",
                    price: 3.50,
                    description: "Une salade fraîche avec des légumes de saison.",
                    ingredients: ["Légumes de saison"],
                    allergens: [],
                    image: "https://placehold.co/400x300/eff6ff/1e40af?text=Salade+composee"
                },
                {
                    id: "salade-russe",
                    name: "Salade russe",
                    price: 3.50,
                    description: "Salade classique avec pommes de terre, carottes, petits pois, et mayonnaise.",
                    ingredients: ["Pommes de terre", "Carottes", "Petits pois", "Mayonnaise"],
                    allergens: ["Œufs", "Moutarde"],
                    image: "https://placehold.co/400x300/fef08a/92400e?text=Salade+russe"
                },
                 {
                    id: "achard-legumes",
                    name: "Achard de légumes",
                    price: 4.00,
                    description: "Légumes marinés et épicés, parfaits pour accompagner vos plats.",
                    ingredients: ["Légumes", "Épices", "Vinaigre"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fce7f3/9d174d?text=Achard+de+legumes"
                },
                {
                    id: "pommes-de-terre-roties",
                    name: "Pommes de terre rôties",
                    price: 3.50,
                    description: "Délicieuses pommes de terre rôties au four.",
                    ingredients: ["Pommes de terre", "Herbes"],
                    allergens: [],
                    image: "https://placehold.co/400x300/fed7aa/ea580c?text=Pommes+de+terre+roties"
                },
                {
                    id: "legumes-marines-farcis",
                    name: "Légumes marinés farcis",
                    price: 4.50,
                    description: "Courgettes ou aubergines farcies et marinées.",
                    ingredients: ["Courgettes", "Aubergines", "Viande hachée"],
                    allergens: [],
                    image: "https://placehold.co/400x300/e9d5ff/6b21a8?text=Légumes+marines+farcis"
                },
            ],
            cakes: [
                {
                    id: "cake-chocolat",
                    name: "Cake au chocolat",
                    cuisine: "Maison",
                    price: 3.00,
                    description: "Un délicieux cake moelleux au chocolat, parfait pour le dessert ou le goûter.",
                    ingredients: ["Farine", "Sucre", "Oeufs", "Beurre", "Chocolat"],
                    allergens: ["Céréales contenant du gluten", "Oeufs", "Lait"],
                    image: "https://placehold.co/400x300/fbcfe8/be185d?text=Cake+au+chocolat"
                },
                 {
                    id: "cake-pistache",
                    name: "Cake à la pistache",
                    cuisine: "Maison",
                    price: 3.50,
                    description: "Un cake à la pistache gourmand et moelleux.",
                    ingredients: ["Farine", "Sucre", "Oeufs", "Beurre", "Pistache"],
                    allergens: ["Céréales contenant du gluten", "Oeufs", "Lait", "Fruits à coque"],
                    image: "https://placehold.co/400x300/d9f99d/4d7c0f?text=Cake+à+la+pistache"
                }
            ]
        };

        const deliveryData = {
            "Zone 1 (Saint-André à Saint-Benoît)": 2.50,
            "Zone 2 (Sainte-Suzanne à Saint-Denis)": 2.50,
            "Zone 3 (Possession, Le Port)": 4.00
        };

        const rendezvousPoints = {
            "Zone 1 (Saint-André à Saint-Benoît)": ["Carrefour Saint-Benoit", "Leclerc Bras Panon", "Super U Saint-André", "Runmarket Saint-André"],
            "Zone 2 (Sainte-Suzanne à Saint-Denis)": ["Carrefour Grand Est Sainte-Suzanne", "Leclerc La Réserve Sainte-Marie", "Runmarket Duparc Sainte-Marie", "Carrefour Grand Nord Saint-Denis", "Leclerc Butor Sainte Clotilde"],
            "Zone 3 (Possession, Le Port)": ["Carrefour Cap Sacré Coeur"]
        };
        
        const allMenuItems = [
            ...menuData.brochettes,
            ...menuData.traditionalDishes,
            ...menuData.soups,
            ...menuData.rotiAuFour,
            ...menuData.sideDishes,
            ...menuData.cakes
        ];

        let cart = {};

        // Fonctions pour gérer le panier
        function addToCart(itemId, quantity = 1) {
            if (cart[itemId]) {
                cart[itemId].quantity += quantity;
            } else {
                const item = allMenuItems.find(i => i.id === itemId);
                if (item) {
                    cart[itemId] = { ...item, quantity: quantity };
                }
            }
            updateCartUI();
        }
        
        function updateCartItemQuantity(itemId, newQuantity) {
            if (cart[itemId]) {
                if (newQuantity <= 0) {
                    removeCartItem(itemId);
                } else {
                    cart[itemId].quantity = newQuantity;
                }
                updateCartUI();
            }
        }
        
        function removeCartItem(itemId) {
            delete cart[itemId];
            updateCartUI();
        }
        
        function clearCart() {
            if (Object.keys(cart).length === 0) return;
            const modal = document.createElement('div');
            modal.className = "fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center";
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto text-center">
                    <h4 class="text-lg font-bold mb-2">Vider le panier</h4>
                    <p class="text-sm text-slate-600">Êtes-vous sûr de vouloir vider votre panier ?</p>
                    <div class="mt-4 flex justify-around">
                        <button onclick="document.body.removeChild(this.parentNode.parentNode.parentNode)" class="px-4 py-2 bg-slate-200 rounded-md text-slate-700">Annuler</button>
                        <button onclick="performClearCart()" class="px-4 py-2 bg-red-600 text-white rounded-md">Vider</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function performClearCart() {
            cart = {};
            updateCartUI();
            const cartModal = document.getElementById('cart-modal');
            if (cartModal) {
                cartModal.remove();
            }
            const confirmModal = document.querySelector('.fixed.inset-0.bg-gray-600.bg-opacity-50');
            if(confirmModal) confirmModal.remove();
        }


        function updateCartUI() {
            const cartCount = document.getElementById('cart-count');
            let totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            // Mettre à jour le contenu de la modale si elle est ouverte
            const modal = document.querySelector('.modal');
            if (modal && modal.id === 'cart-modal') {
                renderCartContent();
            }
        }

        function calculateTotalCost() {
            let total = Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryZone = document.getElementById('delivery-zone').value;
            const deliveryCost = deliveryData[deliveryZone];
            
            if (deliveryCost !== null && !isNaN(deliveryCost)) {
                total += deliveryCost;
            }

            return total;
        }

        function showCartModal() {
            const existingModal = document.getElementById('cart-modal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = "cart-modal";
            modal.className = "modal";
            modal.innerHTML = `
                <div class="modal-content relative bg-white rounded-xl shadow-lg p-8">
                    <button class="modal-close text-slate-500 hover:text-slate-800" onclick="document.body.removeChild(this.parentNode.parentNode)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-center text-slate-900 mb-6">Votre Panier</h2>
                    <div id="cart-content" class="text-left space-y-4 mb-6"></div>
                    <div id="cart-total" class="flex justify-between items-center font-bold text-lg p-4 border-t border-slate-200 mt-4"></div>
                    <div class="flex flex-col md:flex-row justify-between gap-4 mt-4">
                        <button onclick="clearCart()" class="w-full md:w-auto px-6 py-3 bg-red-600 text-white rounded-full font-bold shadow-lg hover:bg-red-700 transition-colors">
                            Vider le panier
                        </button>
                        <button onclick="sendWhatsAppOrder()" class="w-full md:w-auto px-6 py-3 bg-green-600 text-white rounded-full font-bold shadow-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8L22 22l-6.5-1.5a9.61 9.61 0 0 1-5.65 1.5 9.61 9.61 0 0 1-9.61-9.61c0-5.3 4.31-9.61 9.61-9.61s9.61 4.31 9.61 9.61z"></path>
                            </svg>
                            Envoyer la commande sur WhatsApp
                        </button>
                    </div>
                    <p class="text-xs text-slate-500 mt-2">Vous devrez d'abord remplir vos informations de contact.</p>
                </div>
            `;
            document.body.appendChild(modal);
            renderCartContent();
        }

        function renderCartContent() {
            const container = document.getElementById('cart-content');
            const totalContainer = document.getElementById('cart-total');
            container.innerHTML = '';
            
            if (Object.keys(cart).length === 0) {
                container.innerHTML = `<p class="text-center text-slate-500">Votre panier est vide.</p>`;
                totalContainer.innerHTML = `<span>Total :</span><span class="text-amber-600">€0.00</span>`;
                return;
            }

            Object.values(cart).forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center justify-between gap-4 py-2 border-b last:border-b-0 border-slate-200';
                itemDiv.innerHTML = `
                    <div class="flex-1">
                        <h4 class="font-medium text-slate-800">${item.name}</h4>
                        <span class="text-sm text-slate-500">€${item.price.toFixed(2)} l'unité</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="updateCartItemQuantity('${item.id}', ${item.quantity - 1})" class="p-1 bg-slate-200 rounded-full text-slate-600 hover:bg-slate-300 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4"></path></svg>
                        </button>
                        <span class="font-bold w-6 text-center">${item.quantity}</span>
                        <button onclick="updateCartItemQuantity('${item.id}', ${item.quantity + 1})" class="p-1 bg-amber-600 rounded-full text-white hover:bg-amber-700 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg>
                        </button>
                        <button onclick="removeCartItem('${item.id}')" class="p-1 text-red-500 hover:text-red-700 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    <span class="font-bold text-amber-600">€${(item.price * item.quantity).toFixed(2)}</span>
                `;
                container.appendChild(itemDiv);
            });

            totalContainer.innerHTML = `<span>Total :</span><span class="text-amber-600">€${calculateTotalCost().toFixed(2)}</span>`;
        }

        function sendWhatsAppOrder() {
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const deliveryZone = document.getElementById('delivery-zone').value;
            const rendezvousPoint = document.getElementById('rendezvous-point').value;
            const customNote = document.getElementById('custom-note').value;
            const deliveryDate = document.getElementById('delivery-date').value;


            if (!name || !phone || !deliveryDate || !rendezvousPoint || Object.keys(cart).length === 0) {
                const modal = document.createElement('div');
                modal.className = "fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center";
                modal.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto">
                        <h4 class="text-lg font-bold mb-2">Champs manquants ou panier vide</h4>
                        <p class="text-sm text-slate-600">Veuillez remplir toutes les informations requises et avoir au moins un plat dans votre panier pour passer la commande.</p>
                        <button onclick="this.parentNode.parentNode.remove()" class="mt-4 w-full px-4 py-2 bg-amber-600 text-white rounded-md">OK</button>
                    </div>
                `;
                document.body.appendChild(modal);
                return;
            }

            const phoneNumber = "262693805535";
            const totalCostText = calculateTotalCost().toFixed(2);
            
            let orderText = "";
            Object.values(cart).forEach(item => {
                orderText += `- ${item.quantity}x ${item.name} (€${(item.quantity * item.price).toFixed(2)})\n`;
            });

            if (customNote) {
                orderText += `\nNote de personnalisation : ${customNote}\n`;
            }

            const deliveryCost = deliveryData[deliveryZone] !== null ? deliveryData[deliveryZone].toFixed(2) : 'N/A';
            const message = encodeURIComponent(`Nouvelle commande :\n- Nom : ${name}\n- Téléphone : ${phone}\n- Zone de livraison : ${deliveryZone}\n- Point de rendez-vous : ${rendezvousPoint}\n- Frais de livraison: €${deliveryCost}\n- Date de livraison souhaitée : ${deliveryDate}\n\n- Commande :\n${orderText}\n- Coût total : €${totalCostText}\n\n- Heure de commande : ${new Date().toLocaleString('fr-FR')}`);
            
            const whatsappUrl = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${message}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Fonction pour générer le HTML des plats principaux (brochettes)
        function renderBrochettes() {
            const container = document.getElementById('brochettes-menu');
            container.innerHTML = '';
            menuData.brochettes.forEach((dish, index) => {
                const card = createMenuItemCard(dish, `brochettes-ingredients-${index}`);
                container.appendChild(card);
            });
        }

        // Fonction pour générer le HTML des plats traditionnels
        function renderTraditionalDishes() {
            const container = document.getElementById('traditional-dishes-menu');
            container.innerHTML = '';
            menuData.traditionalDishes.forEach((dish, index) => {
                const card = createMenuItemCard(dish, `trad-ingredients-${index}`);
                container.appendChild(card);
            });
        }
        
        // Fonction pour générer le HTML des soupes
        function renderSoups() {
            const container = document.getElementById('soupes-menu');
            container.innerHTML = '';
            menuData.soups.forEach((dish, index) => {
                const card = createMenuItemCard(dish, `soups-ingredients-${index}`);
                container.appendChild(card);
            });
        }

        // Fonction pour générer le HTML des rôtis au four
        function renderRotiAuFour() {
            const container = document.getElementById('roti-au-four-menu');
            container.innerHTML = '';
            menuData.rotiAuFour.forEach((dish, index) => {
                const card = createMenuItemCard(dish, `roti-ingredients-${index}`);
                container.appendChild(card);
            });
        }

        // Fonction pour générer le HTML des accompagnements
        function renderSideDishes() {
            const container = document.getElementById('side-dishes-menu');
            container.innerHTML = '';
            menuData.sideDishes.forEach((side, index) => {
                const card = createMenuItemCard(side, `side-ingredients-${index}`);
                container.appendChild(card);
            });
        }
        
        // Fonction pour générer le HTML des cakes
        function renderCakes() {
            const container = document.getElementById('cakes-menu');
            container.innerHTML = '';
            menuData.cakes.forEach((cake, index) => {
                const card = createMenuItemCard(cake, `cake-ingredients-${index}`);
                container.appendChild(card);
            });
        }


        function createMenuItemCard(dish, ingredientId) {
            const card = document.createElement('div');
            card.className = "menu-item-card bg-slate-50 p-6 rounded-2xl shadow-sm hover:shadow-lg transition-shadow duration-300 transform hover:scale-105 cursor-pointer border border-slate-200";
            
            let allergensHtml = '';
            if (dish.allergens && dish.allergens.length > 0) {
                allergensHtml = `<p class="text-red-500 font-bold text-sm mt-2">Allergènes* : ${dish.allergens.join(', ')}</p>`;
            }

            let cuisineHtml = '';
            if (dish.cuisine) {
                cuisineHtml = `<p class="mt-1 text-slate-500 text-sm font-medium uppercase">${dish.cuisine}</p>`;
            }

            card.innerHTML = `
                <div class="flex justify-between items-center">
                    <h3 class="text-xl md:text-2xl font-semibold text-slate-900">${dish.name}</h3>
                </div>
                ${cuisineHtml}
                <p class="text-2xl font-bold text-amber-600 mt-2">€${dish.price.toFixed(2)}</p>
                <div>
                    <p class="text-sm text-slate-600 mt-4">${dish.description}</p>
                    <div class="mt-2 text-center text-sm text-amber-600 font-bold">
                        Cliquez pour voir les ingrédients
                    </div>
                    <div id="${ingredientId}" class="mt-4 hidden border-t pt-4 border-slate-200">
                        <p class="font-semibold text-slate-800">Ingrédients :</p>
                        <p class="text-sm text-slate-600">${dish.ingredients ? dish.ingredients.join(', ') : 'Non spécifié'}</p>
                        ${allergensHtml}
                    </div>
                </div>
                <div class="mt-4 flex justify-center">
                    <button onclick="event.stopPropagation(); showAddModal('${dish.id}')" class="w-full md:w-auto px-6 py-3 bg-amber-600 text-white rounded-full font-bold shadow-lg hover:bg-amber-700 transition-colors">
                        + Ajouter au panier
                    </button>
                </div>
            `;

            card.addEventListener('click', () => {
                const ingredientsDiv = document.getElementById(ingredientId);
                ingredientsDiv.classList.toggle('hidden');
            });

            return card;
        }

        // Fonction pour générer le HTML de la livraison
        function renderDelivery() {
            const container = document.getElementById('delivery-info');
            container.innerHTML = '';
            for (const zone in deliveryData) {
                const listItem = document.createElement('li');
                listItem.className = "flex justify-between items-center bg-slate-100 p-4 rounded-xl shadow-inner border border-slate-200";
                const priceText = deliveryData[zone] !== null ? `€${deliveryData[zone].toFixed(2)}` : "Contactez-nous pour un devis personnalisé";
                listItem.innerHTML = `
                    <span class="text-slate-700 font-medium">${zone}</span>
                    <span class="text-amber-600 font-bold">${priceText}</span>
                `;
                container.appendChild(listItem);
            }
        }
        
        // Fonction pour générer le HTML des points de rendez-vous
        function renderRendezvousPoints() {
            const container = document.getElementById('rendezvous-info');
            container.innerHTML = '';
            for (const zone in rendezvousPoints) {
                const zoneTitle = document.createElement('h4');
                zoneTitle.className = "font-semibold text-lg text-slate-800 mt-4 mb-2";
                zoneTitle.textContent = zone;
                container.appendChild(zoneTitle);
                
                const ul = document.createElement('ul');
                ul.className = "space-y-2 pl-4 list-disc list-inside";
                rendezvousPoints[zone].forEach(point => {
                    const li = document.createElement('li');
                    li.className = "text-slate-600";
                    li.textContent = point;
                    ul.appendChild(li);
                });
                container.appendChild(ul);
            }
        }

        // Fonction pour générer le menu déroulant des zones de livraison
        function renderDeliverySelect() {
            const select = document.getElementById('delivery-zone');
            select.innerHTML = '';
            for (const zone in deliveryData) {
                const option = document.createElement('option');
                option.value = zone;
                option.textContent = `${zone}${deliveryData[zone] !== null ? ` (€${deliveryData[zone].toFixed(2)})` : ''}`;
                select.appendChild(option);
            }
        }
        
        // Fonction pour générer le menu déroulant des points de rendez-vous
        function renderRendezvousSelect() {
            const select = document.getElementById('rendezvous-point');
            const deliveryZoneSelect = document.getElementById('delivery-zone');
            
            const selectedZone = deliveryZoneSelect.value;
            const points = rendezvousPoints[selectedZone] || [];
            
            select.innerHTML = '';
            points.forEach(point => {
                const option = document.createElement('option');
                option.value = point;
                option.textContent = point;
                select.appendChild(option);
            });
        }
        
        // Ajout d'un écouteur d'événement pour mettre à jour les points de rendez-vous lorsque la zone de livraison change
        document.getElementById('delivery-zone').addEventListener('change', renderRendezvousSelect);


        function showAddModal(itemId) {
            const modal = document.getElementById('add-to-cart-modal');
            const item = allMenuItems.find(i => i.id === itemId);
            if (!item) return;

            document.getElementById('modal-title').textContent = item.name;
            document.getElementById('modal-description').textContent = item.description;
            document.getElementById('modal-image').src = item.image;
            document.getElementById('modal-quantity').textContent = "1";
            document.getElementById('modal-add-price').textContent = `(€${item.price.toFixed(2)})`;

            const quantitySpan = document.getElementById('modal-quantity');
            const plusButton = document.getElementById('modal-plus');
            const minusButton = document.getElementById('modal-minus');
            const addButton = document.getElementById('modal-add-button');

            plusButton.onclick = null;
            minusButton.onclick = null;
            addButton.onclick = null;
            
            const handlePlus = () => {
                let currentQuantity = parseInt(quantitySpan.textContent);
                currentQuantity++;
                quantitySpan.textContent = currentQuantity;
                document.getElementById('modal-add-price').textContent = `(€${(item.price * currentQuantity).toFixed(2)})`;
            };

            const handleMinus = () => {
                let currentQuantity = parseInt(quantitySpan.textContent);
                if (currentQuantity > 1) {
                    currentQuantity--;
                    quantitySpan.textContent = currentQuantity;
                    document.getElementById('modal-add-price').textContent = `(€${(item.price * currentQuantity).toFixed(2)})`;
                }
            };
            
            const handleAdd = () => {
                const quantity = parseInt(quantitySpan.textContent);
                addToCart(itemId, quantity);
                modal.classList.add('hidden');
            };

            plusButton.onclick = handlePlus;
            minusButton.onclick = handleMinus;
            addButton.onclick = handleAdd;

            modal.classList.remove('hidden');

            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            };
        }
        
        const chatBubble = document.getElementById('chat-bubble');
        const chatContainer = document.getElementById('chat-container');
        const closeChatButton = document.getElementById('close-chat');
        const chatInput = document.getElementById('chat-input');
        const sendChatButton = document.getElementById('send-chat');
        const chatBody = document.getElementById('chat-body');

        let chatHistory = [];
        const menuText = JSON.stringify(menuData);
        const systemPrompt = `Vous êtes un assistant de menu pour le restaurant 'Oh Brochetti'. Vous êtes amical, serviable et conversationnel. 
        Répondez aux questions des clients sur le menu, faites des recommandations et fournissez des informations. 
        Utilisez uniquement les informations suivantes sur le menu pour répondre. Ne vous inventez rien.
        MENU : ${menuText}`;

        chatBubble.addEventListener('click', () => {
            chatContainer.classList.toggle('hidden');
        });

        closeChatButton.addEventListener('click', () => {
            chatContainer.classList.add('hidden');
        });

        sendChatButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (userMessage === '') return;

            appendMessage(userMessage, 'user');
            chatInput.value = '';

            const loadingMessage = appendMessage('...', 'bot');
            const apiKey = "";
            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;

            chatHistory.push({ role: "user", parts: [{ text: userMessage }] });

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }

                const result = await response.json();
                const geminiText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Désolé, je n'ai pas pu générer de réponse pour le moment.";
                
                loadingMessage.textContent = geminiText;
                chatHistory.push({ role: "model", parts: [{ text: geminiText }] });

            } catch (error) {
                console.error("Erreur de l'API Gemini:", error);
                loadingMessage.textContent = "Désolé, une erreur s'est produite. Veuillez réessayer.";
            } finally {
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }

        function appendMessage(text, role) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}-message`;
            messageDiv.textContent = text;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
            return messageDiv;
        }

        async function fetchWithRetry(url, options, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) {
                        return response;
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
                }
            }
            throw new Error("Toutes les tentatives de connexion ont échoué.");
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderBrochettes();
            renderTraditionalDishes();
            renderSoups();
            renderRotiAuFour();
            renderSideDishes();
            renderCakes();
            renderDelivery();
            renderRendezvousPoints();
            renderDeliverySelect();
            renderRendezvousSelect();
            updateCartUI();
        });
    </script>

</body>
</html>
